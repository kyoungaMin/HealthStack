# 2026-02-07 Devlog

## 1. Supabase CLI & Migration Setup
- **CLI 설치**: npm을 통해 Supabase CLI v2.75.5 설치 완료.
- **프로젝트 연결**: `bvowxbpqtfpkkxkzsumf` 프로젝트와 로컬 환경 링크.
- **마이그레이션 구조화**:
  - 기존 `database/sql`의 파편화된 스크립트를 `supabase/migrations`로 이관 및 타임스탬프 기반 버전 관리 적용.
  - 마이그레이션 파일 목록:
    1. `20260206220000_extend_master_tables.sql`
    2. `20260206220100_foods_master_seed.sql`
    3. `20260206220200_disease_master_seed.sql`
    4. `20260206220300_tkm_symptom_master_seed.sql`
    5. `20260206220400_tkm_to_modern_map_seed.sql`
    6. `20260206220500_symptom_ingredient_map_seed.sql`
    7. `20260206220600_recipes_symptom_recipe_map_seed.sql`
    8. `20260206220700_pubmed_search_seed.sql`

## 2. DB Schema Finalization (ERD Update)
`docs/erd/schema.integrated.dbml` 업데이트 완료.

### 주요 변경 사항
- **Master Tables 확장**:
  - `tkm_symptom_master`: `name_en` 컬럼 추가 및 인덱스 생성.
  - `foods_master` / `disease_master`: 현대어 매핑 및 메타데이터 컬럼 확장.
- **Mapping & Logic Tables**:
  - `symptom_ingredient_map`: `evidence_level`, `source_ref`, `rationale_ko` 등 컬럼 추가하여 추천 로직 정교화.
  - `symptom_recipe_map`: `meal_slot`, `best_time` 등으로 상황별 레시피 추천 지원.
- **PubMed Search Strategy**:
  - `modern_to_mesh_map`: 질병명 → MeSH 검색어 매핑.
  - `symptom_pubmed_map`: 증상 → PubMed 키워드 매핑.
  - `ingredient_pubmed_map`: 식재료 → 생리활성물질(Bioactive Compound) → MeSH 매핑.

## 3. 이슈 해결 및 향후 과제
### 이슈 (Resolved/Pending)
- **Supabase CLI Encoding**: 한글이 포함된 대규모 SQL (Seed data) 푸시 시 인코딩/파싱 에러 발생.
  - **해결책**: 복잡한 Seed Data는 Dashboard SQL Editor에서 직접 실행 권장.
- **CHECK 제약조건 충돌**: 기존 테이블의 제약조건과 새로운 시드 데이터(`meal_slot`, `evidence_level` 등) 불일치.
  - **해결책**: `ALTER TABLE DROP CONSTRAINT` 후 재생성하는 SQL 스크립트 제공.

### Next Steps
- **Golden Questions 테스트**: `docs/test/golden_questions_v1.md`를 활용하여 실제 검색 품질 평가.
- **Python 검색 엔진 구현**: DB 데이터를 활용한 하이브리드 검색(키워드+벡터) 로직 구현.

## 4. UI/UX 개선 및 처방전 분석 기능 (Golden Questions & Medication Analysis)
### 주요 변경 사항
- **Golden Questions API 구축**:
  - `faq_service.py`: 자주 묻는 질문 30개를 JSON 데이터로 제공.
  - API 엔드포인트 `/api/golden-questions` 추가.
  - UI: 카테고리 탭 및 페이지네이션 기능 구현.
- **처방전 분석 서비스 (MedicationService)**:
  - `medication_service.py`: 처방전 이미지 업로드 및 로컬 DB(`data/prescriptions.json`) 저장.
  - `Naver OCR` 연동: 처방전에서 약물명 추출.
  - `PubMed & RAG`: 약물 정보를 검색하고 Gemini AI로 요약하는 파이프라인 구축.
  - **예외 처리**: `google-generative-ai` 모듈 부재 시 서버 크래시 방지 (`try-except` 블록 적용).
- **사용자 경험 (UX) 강화**:
  - '데모' -> **'✨ 체험하기'**로 용어 변경.
  - **분석 기록 (History)**: `localStorage` 기반의 분석 이력 저장 및 '내 기록(Report)' 탭 구현.
  - **처방전 업로드**: 입력창에 카메라 아이콘 버튼 추가.
