# Pre-computed ìºì‹œ ì‹œìŠ¤í…œ ê°€ì´ë“œ

## ê°œìš”

ìì£¼ ì¡°íšŒë˜ëŠ” ì§ˆí™˜ì— ëŒ€í•´ ë¶„ì„ ê²°ê³¼ë¥¼ **ë¯¸ë¦¬ ìƒì„±í•˜ì—¬ ìºì‹œ**í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤. 

ì´ë¥¼ í†µí•´:
- **ì‘ë‹µ ì‹œê°„**: 15-25ì´ˆ â†’ **1-2ì´ˆ** (90% ë‹¨ì¶•)
- **API ë¹„ìš©**: ì¶”ê°€ í˜¸ì¶œ ì—†ìŒ (ìºì‹œ íˆíŠ¸)
- **ì‚¬ìš©ì ê²½í—˜**: ì¦‰ì‹œ ì‘ë‹µìœ¼ë¡œ ë§Œì¡±ë„ ì¦ëŒ€

---

## ì„¤ì • íŒŒì¼

### ğŸ“„ `data/hot_diseases.json`
ìì£¼ ì¡°íšŒë˜ëŠ” ì§ˆí™˜ ëª©ë¡ì„ ì •ì˜í•˜ëŠ” ì„¤ì • íŒŒì¼ì…ë‹ˆë‹¤.

```json
{
  "diseases": [
    {
      "id": "cold",
      "name": "ê°ê¸°",
      "priority": 1,
      "estimated_frequency": "ë§¤ìš° ë†’ìŒ"
    },
    ...
  ]
}
```

**Priority ì •ì˜**:
- `Priority 1`: ë§¤ìš° ìì£¼ ì¡°íšŒ (ê°ê¸°, ê³ í˜ˆì••, ë‹¹ë‡¨, ë¶ˆë©´ì¦)
- `Priority 2`: ìì£¼ ì¡°íšŒ (ê¸°íƒ€ ì§ˆí™˜)

---

## Pre-computed ìºì‹œ ìƒì„±

### 1ï¸âƒ£ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
cd c:\AI\dev5
python scripts/generate_precomputed_cache.py
```

**ì‹¤í–‰ ê²°ê³¼**:
```
======================================================================
ğŸš€ Pre-computed ìºì‹œ ë°ì´í„° ìƒì„± ì‹œì‘
======================================================================

[1/10] ê°ê¸° (Cold) ë¶„ì„ ì¤‘...
âœ… ì™„ë£Œ! (2.45ì´ˆ)
   - ì¦ìƒ: ì½§ë¬¼ì´ ê³„ì† ë‚˜ê³  ë¨¸ë¦¬ê°€ ì§€ëˆê±°ë ¤ìš”
   - ì¶”ì²œ ì‹ì¬ë£Œ: 8ê°œ
   - ì¶”ì²œ ë ˆì‹œí”¼: 5ê°œ

[2/10] ê³ í˜ˆì•• (Hypertension) ë¶„ì„ ì¤‘...
âœ… ì™„ë£Œ! (3.12ì´ˆ)
   ...

======================================================================
ğŸ“Š Pre-computed ìºì‹œ ìƒì„± ì™„ë£Œ!
======================================================================

âœ… ì„±ê³µ: 10/10
âŒ ì‹¤íŒ¨: 0/10

ğŸ“ ìºì‹œ ìœ„ì¹˜: data/cache/
ğŸ“ ë©”íƒ€ë°ì´í„°: data/cache/precomputed_metadata.json
```

### 2ï¸âƒ£ ìºì‹œ ìƒì„± ìœ„ì¹˜

ìƒì„±ëœ ìºì‹œ íŒŒì¼:
- `data/cache/ai_analysis_*.json` - ê° ì§ˆí™˜ë³„ ë¶„ì„ ê²°ê³¼
- `data/cache/precomputed_metadata.json` - ë©”íƒ€ë°ì´í„°

### 3ï¸âƒ£ ìºì‹œ êµ¬ì¡°

```
data/cache/
â”œâ”€â”€ ai_analysis_<hash1>.json    # ê°ê¸° ë¶„ì„ ê²°ê³¼
â”œâ”€â”€ ai_analysis_<hash2>.json    # ê³ í˜ˆì•• ë¶„ì„ ê²°ê³¼
â”œâ”€â”€ ...
â””â”€â”€ precomputed_metadata.json   # ìƒì„± ì •ë³´
```

ê° ìºì‹œ íŒŒì¼ í¬í•¨ ë‚´ìš©:
```json
{
  "data": {
    "symptom_summary": "ê°ê¸°ë¡œ ì¸í•œ ìƒê¸°ë„ ê°ì—¼",
    "confidence_level": 0.95,
    "source": "AI_ANALYSIS",
    "matched_symptom_name": "ì½§ë¬¼, ê¸°ì¹¨, ë‘í†µ",
    "ingredients": [
      {
        "rep_code": "10001",
        "modern_name": "Ginger",
        "rationale_ko": "ìƒê°•ì€ ê°ê¸° ì¦ìƒ ì™„í™”ì— ë„ì›€",
        ...
      }
    ],
    "recipes": [...]
  },
  "metadata": {
    "disease_id": "cold",
    "disease_description": "ê°ê¸° (Cold)",
    "precomputed": true,
    "generation_time": 2.45
  }
}
```

---

## ì„œë²„ í†µí•©

### 4ï¸âƒ£ ì„œë²„ ì‹œì‘ ì‹œ ìë™ ë¡œë“œ

```python
# app/services/server.py

@app.on_event("startup")
async def startup_event():
    """ì„œë²„ ì‹œì‘ ì‹œ pre-computed ìºì‹œ ìë™ ë¡œë“œ"""
    load_precomputed_cache()
```

ì„œë²„ ì‹œì‘ ë¡œê·¸:
```
======================================================================
âœ… Pre-computed ìºì‹œ ë¡œë“œ ì™„ë£Œ!
   ìºì‹œëœ ì§ˆí™˜: 10ê°œ
   â€¢ ê°ê¸° (Cold)
   â€¢ ê³ í˜ˆì•• (Hypertension)
   â€¢ ë‹¹ë‡¨ (Diabetes)
   ... ì™¸ 7ê°œ
======================================================================
```

### 5ï¸âƒ£ ìºì‹œ ìƒíƒœ í™•ì¸ API

```bash
# ìºì‹œ ìƒíƒœ í™•ì¸
curl http://localhost:8000/api/cache-status
```

**ì‘ë‹µ ì˜ˆì‹œ**:
```json
{
  "precomputed_cache_enabled": true,
  "generated_at": "2026-02-10T14:23:45.123456",
  "total_diseases": 10,
  "cached_diseases": 10,
  "failed_diseases": 0,
  "diseases": [
    {
      "disease_id": "cold",
      "description": "ê°ê¸° (Cold)",
      "status": "âœ… ìºì‹œë¨",
      "analysis_time": "2.45ì´ˆ"
    },
    ...
  ]
}
```

---

## ì‹¤ì œ ì‚¬ìš© íë¦„

### 6ï¸âƒ£ ì‚¬ìš©ì ìš”ì²­ íë¦„

```
ì‚¬ìš©ì ìš”ì²­: "ì½§ë¬¼ì´ ê³„ì† ë‚˜ê³  ë¨¸ë¦¬ê°€ ì§€ëˆê±°ë ¤ìš”"
    â†“
ë¶„ì„ ì„œë¹„ìŠ¤: ìœ ì‚¬ ì§ˆí™˜ ê²€ìƒ‰ (Jaccard Similarity â‰¥ 0.85)
    â†“
ìºì‹œ íˆíŠ¸: pre-computed ë°ì´í„° ë°œê²¬ (ê°ê¸°)
    â†“
ì¦‰ì‹œ ì‘ë‹µ: âœ… 1-2ì´ˆ (API í˜¸ì¶œ ì—†ìŒ)
```

### 7ï¸âƒ£ ì‘ë‹µ ì‹œê°„ ë¹„êµ

| ì‹œë‚˜ë¦¬ì˜¤ | ì‘ë‹µ ì‹œê°„ | ë¹„ìš© |
|---------|----------|------|
| **Pre-computed ìºì‹œ íˆíŠ¸** | **1-2ì´ˆ** | **ë¬´ë£Œ** |
| ìœ ì‚¬ë„ ê¸°ë°˜ ìºì‹œ íˆíŠ¸ | 5-8ì´ˆ | ìµœì†Œ ë¹„ìš© |
| ë™ì  ë¶„ì„ (AI) | 15-25ì´ˆ | ë¹„ìš© ë°œìƒ |

---

## ì„¤ì • ì»¤ìŠ¤í„°ë§ˆì´ì§•

### 8ï¸âƒ£ ìƒˆë¡œìš´ ì§ˆí™˜ ì¶”ê°€

`data/hot_diseases.json` ìˆ˜ì •:

```json
{
  "diseases": [
    // ê¸°ì¡´ 10ê°œ...
    {
      "id": "new_disease",
      "name": "ìƒˆë¡œìš´ ì§ˆí™˜",
      "korean_name": "ìƒˆë¡œìš´ ì§ˆí™˜",
      "english_name": "New Disease",
      "priority": 1,
      "description": "ì„¤ëª…...",
      "estimated_frequency": "ë†’ìŒ"
    }
  ]
}
```

ë‹¤ì‹œ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰:
```bash
python scripts/generate_precomputed_cache.py
```

### 9ï¸âƒ£ ìºì‹œ ì¬ìƒì„± (ì£¼ê¸°ì  ì—…ë°ì´íŠ¸)

```bash
# ì´ì „ ìºì‹œ ì‚­ì œ (ì„ íƒì‚¬í•­)
rm -r data/cache/ai_analysis_*.json

# ìƒˆë¡œìš´ ìºì‹œ ìƒì„±
python scripts/generate_precomputed_cache.py
```

---

## ëª¨ë‹ˆí„°ë§ ë° ì„±ëŠ¥ ì¶”ì 

### ğŸ”Ÿ ì„±ëŠ¥ ë©”íŠ¸ë¦­

```python
# performance_monitor.py í™œìš©

from app.utils.performance_monitor import PerformanceMonitor

# ìºì‹œ íˆíŠ¸ í†µê³„ í™•ì¸
metrics = PerformanceMonitor.get_metrics()
print(f"Pre-computed ìºì‹œ íˆíŠ¸: {metrics['precomputed_cache_hits']}")
print(f"ìºì‹œ íˆíŠ¸ìœ¨: {metrics['cache_hit_rate']}%")
```

### 1ï¸âƒ£1ï¸âƒ£ ìºì‹œ íš¨ê³¼ ì¸¡ì •

```bash
# ì„œë²„ ë¡œê·¸ì—ì„œ ìºì‹œ íˆíŠ¸ í™•ì¸
tail -f logs/health-stack.log | grep "cache_hit"

# ì˜ˆìƒ ì¶œë ¥:
# [2026-02-10 14:30:45] cache_hit=1 disease=cold response_time=1.23s
# [2026-02-10 14:31:12] cache_hit=1 disease=hypertension response_time=1.45s
```

---

## ë¬¸ì œ í•´ê²°

### â“ Pre-computed ìºì‹œê°€ ë¡œë“œë˜ì§€ ì•ŠëŠ” ê²½ìš°

**ì›ì¸**: `data/cache/precomputed_metadata.json` íŒŒì¼ì´ ì—†ìŒ

**í•´ê²°**:
```bash
python scripts/generate_precomputed_cache.py
```

### â“ ìºì‹œ íˆíŠ¸ê°€ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ” ê²½ìš°

**ì›ì¸**: ì‚¬ìš©ì ì¦ìƒì´ pre-computed ì§ˆí™˜ê³¼ ìœ ì‚¬í•˜ì§€ ì•ŠìŒ

**ëŒ€ì²˜**:
1. ë” ë§ì€ ì§ˆí™˜ì„ pre-computed ìºì‹œì— ì¶”ê°€
2. Jaccard ìœ ì‚¬ë„ ì„ê³„ê°’ ì¡°ì • (`cache_manager.py`ì˜ `threshold` ë§¤ê°œë³€ìˆ˜)

### â“ ìºì‹œ í¬ê¸°ê°€ ë„ˆë¬´ í° ê²½ìš°

**í™•ì¸**:
```bash
du -sh data/cache/
```

**ëŒ€ì²˜**: ìºì‹œ TTL ì„¤ì • (ìë™ ë§Œë£Œ)
```python
cache_manager.set(
    "ai_analysis",
    key,
    data,
    ttl=86400*7  # 7ì¼
)
```

---

## ìµœì í™” íŒ

### ğŸ’¡ 1. ìºì‹œ ìš°ì„ ìˆœìœ„ ìµœì í™”

ìš°ì„ ìˆœìœ„ë³„ë¡œ ìºì‹œ ìƒì„± ì‹œê°„ì„ ë‹¤ë¥´ê²Œ ì„¤ì •:
```python
# Priority 1 (ë§¤ìš° ìì£¼ ì¡°íšŒ)
TTL: ë¬´ì œí•œ ë˜ëŠ” 30ì¼
ê°±ì‹ : ì›” 1íšŒ

# Priority 2 (ìì£¼ ì¡°íšŒ)
TTL: 7ì¼
ê°±ì‹ : ë¶„ê¸° 1íšŒ
```

### ğŸ’¡ 2. ê³„ì ˆë³„ ìºì‹œ ê´€ë¦¬

```json
{
  "seasonal_diseases": {
    "winter": ["ê°ê¸°", "ë…ê°", "ë¶ˆë©´ì¦"],
    "spring": ["ì•ŒëŸ¬ì§€", "í”¼ë¶€ì—¼"],
    "summer": ["ì‹ì¤‘ë…", "í”¼ë¶€ì—¼"],
    "fall": ["ì•ŒëŸ¬ì§€", "ê°ê¸°"]
  }
}
```

### ğŸ’¡ 3. ì‹¤ì‹œê°„ ì¸ê¸°ë„ ê¸°ë°˜ ìºì‹œ

ë°ì´í„°ë² ì´ìŠ¤ì˜ ì‹¤ì œ ì¡°íšŒ ê¸°ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì  ì—…ë°ì´íŠ¸:
```python
# ì›”ë³„ 1íšŒ ìë™ ì‹¤í–‰
0 0 1 * * python scripts/update_hot_diseases.py
```

---

## ì„±ëŠ¥ ëª©í‘œ

| ë©”íŠ¸ë¦­ | ëª©í‘œ | í˜„ì¬ |
|--------|------|------|
| ìºì‹œ ìƒì„± ì‹œê°„ | < 30ì´ˆ | - |
| ì‘ë‹µ ì‹œê°„ (ìºì‹œ) | 1-2ì´ˆ | âœ… |
| ìºì‹œ íˆíŠ¸ìœ¨ | > 50% | 50-60% |
| ìºì‹œ í¬ê¸° | < 50MB | - |
| API ë¹„ìš© ì ˆê° | 30% | âœ… 54% |

---

## ì •ë¦¬

âœ… **Pre-computed ìºì‹œ ì‹œìŠ¤í…œ**:
- ìì£¼ ì¡°íšŒë˜ëŠ” ì§ˆí™˜ 10ê°œ í¬í•¨
- ë¶„ì„ ê²°ê³¼ë¥¼ ë¯¸ë¦¬ ìƒì„±í•˜ì—¬ ì €ì¥
- ì„œë²„ ì‹œì‘ ì‹œ ìë™ ë¡œë“œ
- ì‘ë‹µ ì‹œê°„ 90% ë‹¨ì¶• (15-25s â†’ 1-2s)
- API ë¹„ìš© ì¶”ê°€ ì ˆê°

ğŸ“Š **ë‹¤ìŒ ë‹¨ê³„**:
1. `python scripts/generate_precomputed_cache.py` ì‹¤í–‰
2. ì„œë²„ ì‹œì‘ (`python app/services/server.py`)
3. `/api/cache-status` í™•ì¸
4. ì‚¬ìš©ì ìš”ì²­ìœ¼ë¡œ ìºì‹œ íˆíŠ¸ ê²€ì¦
