# 분석 UX/UI 개선 및 단계별 진행 프로세스 설계

## 1. 개요 (Overview)
사용자가 처방전 분석이나 증상 검색 시 대기 시간을 줄이고, 정보의 정확성을 높이며, 흥미를 유발할 수 있도록 **단계별 대화형 프로세스**를 도입합니다.
사용자는 각 단계에서 자신의 상태를 확인하고 선택함으로써 최종 분석 결과에 대한 신뢰도를 높일 수 있습니다.

## 2. 단계별 시나리오 (Step-by-Step Flow)

### Step 1: 증상/처방전 입력 및 1차 인식 (즉시 응답)
**목표:** 사용자의 입력을 빠르게 인식했음을 알리고, 핵심 키워드를 추출하여 확인받습니다.
**UX 전략:** 로딩 스피너 대신 실시간 분석 애니메이션 표시.

**사용자 문구 (Friendly Message):**
> "잠시만요! 🧐 처방전을 꼼꼼히 읽어보고 있어요... (또는 증상을 파악중이에요)"
> "여기 적힌 내용이... **'두통'**과 **'소화불량'**이 맞나요? 혹시 제가 잘못 읽었다면 알려주세요!" 

**UI 구성 (Actionable UI):**
- [이미지 썸네일] (처방전 업로드 시)
- **추출된 키워드 태그 (수정 가능):** [ #두통 (x) ] [ #소화불량 (x) ] [ + 키워드 추가 ]
- **하단 버튼:** "네, 맞아요! 다음 단계로 👉"

---

### Step 2: 연관 증상 및 약물 후보 탐색 (중간 응답)
**목표:** 1단계 키워드를 바탕으로 동의보감(증상)과 의약품(약물) DB에서 관련 정보를 찾아 선택지를 제공합니다. (RAG 검색 결과)
**UX 전략:** 사용자가 직접 "자신의 증상과 가장 비슷한" 항목을 고르게 하여 정확도 향상.

**사용자 문구 (Friendly Message):**
> "찾았다! 🕵️‍♀️ 비슷한 증상이나 약에 대한 기록이 있어요."
> "어떤 상황인지 조금 더 자세히 알려주실 수 있나요? 가장 비슷한 걸 콕! 집어주세요."

**UI 구성 (Interactive Selection):**
**(A) 동의보감 증상 후보 (카드형 리스트)**
- [선택] **두풍증 (동의보감)**: "머리가 지끈거리고 바람을 쐬면 더 아파요."
- [선택] **식적 (동의보감)**: "체한 것처럼 명치가 답답하고 머리가 아파요."

**(B) 약물 후보 (약학정보)**
- [선택] **타이레놀**: "열을 내리고 통증을 줄여줘요."
- [선택] **베아제**: "소화를 돕고 위를 편안하게 해요."

**하단 버튼:** "선택 완료! 분석 결과 보기 ✨"

---

### Step 3: 최종 분석 및 맞춤 제안 (최종 응답)
**목표:** 사용자가 선택한 정보를 종합하여 LLM이 최종 리포트를 생성합니다. (식이요법, 생활습관, 주의사항 등)
**UX 전략:** 단순 텍스트 나열 대신, 시각적으로 구조화된 리포트 제공.

**사용자 문구 (Friendly Message):**
> "모든 준비가 끝났어요! 📝 **[사용자 닉네임]**님만을 위한 맞춤 건강 리포트가 나왔습니다."
> "약과 함께 드시면 좋은 음식, 피해야 할 음식을 알려드릴게요!"

**UI 구성 (Final Report):**
1. **요약 카드:** "현재 **[소화불량성 두통]**이 의심됩니다."
2. **약물 정보:** "복용 중인 약(**타이레놀**)은 **간**에 무리를 줄 수 있으니 **음주**는 절대 피하세요! 🚫🍺"
3. **동의보감 추천:** "동의보감에서는 **'무(Radish)'**가 소화를 돕고 두통을 줄인다고 해요. 오늘 저녁 시원한 무국 어떠세요? 🥣"
4. **주의사항:** "이러이러한 증상이 지속되면 꼭 병원을 방문하세요."

---

## 3. 기술적 구현 방안 (Technical Implementation)

1. **Backend API 분리:**
   - `/api/analyze/extract`: OCR/Keyword 추출 (Fast)
   - `/api/analyze/search`: DB/Vector Search (Medium)
   - `/api/analyze/synthesize`: LLM Final Report (Slow but comprehensive)

2. **Frontend State Management:**
   - `AnalysisStep` 상태값 (1, 2, 3)에 따라 UI 전환.
   - 각 단계 데이터(`keywords`, `candidates`, `finalReport`)를 누적하여 다음 API 호출 시 전달.

3. **Data Pre-loading:**
   - Step 2에서 사용자가 고민하는 동안, 백그라운드에서는 Step 3를 위한 프롬프트를 미리 준비하거나 관련 텍스트를 캐싱.

## 4. 기대 효과
- **체감 속도 향상:** 긴 로딩 없이 즉각적인 피드백.
- **정확도 상승:** 사용자가 모호한 OCR 결과나 검색 결과를 직접 필터링.
- **사용자 경험(UX) 개선:** 대화하듯 자연스러운 흐름으로 헬스케어 서비스의 친근함 제공.
